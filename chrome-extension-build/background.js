var background=function(){"use strict";var Gt=Object.defineProperty;var qe=E=>{throw TypeError(E)};var Vt=(E,l,R)=>l in E?Gt(E,l,{enumerable:!0,configurable:!0,writable:!0,value:R}):E[l]=R;var k=(E,l,R)=>Vt(E,typeof l!="symbol"?l+"":l,R),Je=(E,l,R)=>l.has(E)||qe("Cannot "+R);var J=(E,l,R)=>(Je(E,l,"read from private field"),R?R.call(E):l.get(E)),ge=(E,l,R)=>l.has(E)?qe("Cannot add the same private member more than once"):l instanceof WeakSet?l.add(E):l.set(E,R),Pe=(E,l,R,Z)=>(Je(E,l,"write to private field"),Z?Z.call(E,R):l.set(E,R),R);var De,Le,M,U,Me,Ue;function E(t){return t==null||typeof t=="function"?{main:t}:t}const l=((Le=(De=globalThis.browser)==null?void 0:De.runtime)==null?void 0:Le.id)==null?globalThis.chrome:globalThis.browser;function R(t,e,r){var n=r||{},o=n.noTrailing,c=o===void 0?!1:o,h=n.noLeading,m=h===void 0?!1:h,u=n.debounceMode,f=u===void 0?void 0:u,y,g=!1,p=0;function w(){y&&clearTimeout(y)}function S(F){var b=F||{},v=b.upcomingOnly,_=v===void 0?!1:v;w(),g=!_}function T(){for(var F=arguments.length,b=new Array(F),v=0;v<F;v++)b[v]=arguments[v];var _=this,A=Date.now()-p;if(g)return;function s(){p=Date.now(),e.apply(_,b)}function i(){y=void 0}!m&&f&&!y&&s(),w(),f===void 0&&A>t?m?(p=Date.now(),c||(y=setTimeout(f?i:s,t))):s():c!==!0&&(y=setTimeout(f?i:s,f===void 0?t-A:t))}return T.cancel=S,T}function Z(t,e,r){var n={},o=n.atBegin,c=o===void 0?!1:o;return R(t,e,{debounceMode:c!==!1})}function pe(t){return new Proxy(t,{get(e,r){if(e[r])return typeof e[r]!="function"?new pe(e[r]):(...n)=>new Promise((o,c)=>{e[r](...n,h=>{chrome.runtime.lastError?c(new Error(chrome.runtime.lastError.message)):o(h)})})}})}const me=globalThis.chrome&&new pe(globalThis.chrome);function ie(t){if(!t)return!1;try{const{pathname:e}=new URL(t,location.origin);return e===location.pathname}catch{return!1}}function ye(t){var e,r,n;return(n=(r=(e=globalThis.chrome)==null?void 0:e.runtime)==null?void 0:r.getManifest)==null?void 0:n.call(r)}function Ae(t){let e;return()=>(e===void 0&&(e=t()),e)}const He=()=>Qe()||je(),Qe=Ae(()=>{var e,r;const t=ye();return t?ie(t.background_page??((e=t.background)==null?void 0:e.page))?!0:!!((r=t.background)!=null&&r.scripts&&ie("/_generated_background_page.html")):!1}),je=Ae(()=>{var t,e;return ie((e=(t=ye())==null?void 0:t.background)==null?void 0:e.service_worker)});var Ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Ze=function(){function t(e,r){for(var n=0;n<r.length;n++){var o=r[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),K=function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},G=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t},V=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};P(this,t),this.registeredTypes=e}return Ze(t,[{key:"get",value:function(r){return typeof this.registeredTypes[r]<"u"?this.registeredTypes[r]:this.registeredTypes.default}},{key:"register",value:function(r,n){typeof this.registeredTypes[r]>"u"&&(this.registeredTypes[r]=n)}},{key:"registerDefault",value:function(r){this.register("default",r)}}]),t}(),we=function(t){K(e,t);function e(r){P(this,e);var n=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return n.registerDefault(function(o){return o.getAttribute("name")||""}),n}return e}(V),Ke=function(t){K(e,t);function e(r){P(this,e);var n=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return n.registerDefault(function(o){return o.value}),n.register("checkbox",function(o){return o.getAttribute("value")!==null?o.checked?o.getAttribute("value"):null:o.checked}),n.register("select",function(o){return Ge(o)}),n}return e}(V);function Ge(t){var e,r,n,o=t.options,c=t.selectedIndex,h=t.type==="select-one",m=h?null:[],u=h?c+1:o.length;for(c<0?n=u:n=h?c:0;n<u;n++)if(r=o[n],(r.selected||n===c)&&!r.disabled&&!(r.parentNode.disabled&&r.parentNode.tagName.toLowerCase()==="optgroup")){if(e=r.value,h)return e;m.push(e)}return m}var Ve=function(t){K(e,t);function e(r){P(this,e);var n=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return n.registerDefault(function(){return!0}),n.register("radio",function(o){return o.checked}),n}return e}(V);function ze(t){var e=t.match(/[^[\]]+/g),r=void 0;return t.length>1&&t.indexOf("[]")===t.length-2&&(r=e.pop(),e.push([r])),e}function se(t){var e=void 0,r=t.tagName,n=r;return r.toLowerCase()==="input"&&(e=t.getAttribute("type"),e?n=e:n="text"),n.toLowerCase()}function be(t,e){return Array.prototype.filter.call(t.querySelectorAll("input,select,textarea"),function(r){if(r.tagName.toLowerCase()==="input"&&(r.type==="submit"||r.type==="reset"))return!1;var n=se(r),o=e.keyExtractors.get(n),c=o(r),h=(e.include||[]).indexOf(c)!==-1,m=(e.exclude||[]).indexOf(c)!==-1,u=!1,f=!1;if(e.ignoredTypes){var y=!0,g=!1,p=void 0;try{for(var w=e.ignoredTypes[Symbol.iterator](),S;!(y=(S=w.next()).done);y=!0){var T=S.value;r.matches(T)&&(u=!0)}}catch(F){g=!0,p=F}finally{try{!y&&w.return&&w.return()}finally{if(g)throw p}}}return h?f=!1:e.include?f=!0:f=m||u,!f})}function ve(t,e,r){if(!e)return t;var n=e.shift();return t[n]||(t[n]=Array.isArray(n)?[]:{}),e.length===0&&(Array.isArray(t[n])?r!==null&&t[n].push(r):t[n]=r),e.length>0&&ve(t[n],e,r),t}function Xe(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={};return e.keySplitter=e.keySplitter||ze,e.keyExtractors=new we(e.keyExtractors||{}),e.inputReaders=new Ke(e.inputReaders||{}),e.keyAssignmentValidators=new Ve(e.keyAssignmentValidators||{}),Array.prototype.forEach.call(be(t,e),function(n){var o=se(n),c=e.keyExtractors.get(o),h=c(n),m=e.inputReaders.get(o),u=m(n),f=e.keyAssignmentValidators.get(o);if(f(n,h,u)){var y=e.keySplitter(h);r=ve(r,y,u)}}),r}var We=function(t){K(e,t);function e(r){P(this,e);var n=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return n.registerDefault(function(o,c){o.value=c}),n.register("checkbox",function(o,c){c===null?o.indeterminate=!0:o.checked=Array.isArray(c)?c.indexOf(o.value)!==-1:c}),n.register("radio",function(o,c){c!==void 0&&(o.checked=o.value===c.toString())}),n.register("select",et),n}return e}(V);function $e(t){var e=[];return t!==null&&(Array.isArray(t)?e.push.apply(e,t):e.push(t)),e}function et(t,e){for(var r,n,o=t.options,c=$e(e),h=o.length;h--;)n=o[h],c.indexOf(n.value)>-1&&(n.setAttribute("selected",!0),r=!0);r||(t.selectedIndex=-1)}function tt(t,e){return t+"["+e+"]"}function _e(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n={},o=r.keyJoiner||tt;for(var c in t)if(t.hasOwnProperty(c)){var h=t[c],m={};e&&(c=o(e,c)),Array.isArray(h)?(m[c+"[]"]=h,m[c]=h):(typeof h>"u"?"undefined":Ye(h))==="object"?m=_e(h,c,r):m[c]=h,Object.assign(n,m)}return n}function rt(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=_e(e,null,r);r.keyExtractors=new we(r.keyExtractors||{}),r.inputWriters=new We(r.inputWriters||{}),Array.prototype.forEach.call(be(t,r),function(o){var c=se(o),h=r.keyExtractors.get(c),m=h(o),u=r.inputWriters.get(c),f=n[m];u(o,f)})}function nt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var z={exports:{}};z.exports;var ke;function ot(){return ke||(ke=1,function(t){var e=function(){var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",c={};function h(u,f){if(!c[u]){c[u]={};for(var y=0;y<u.length;y++)c[u][u.charAt(y)]=y}return c[u][f]}var m={compressToBase64:function(u){if(u==null)return"";var f=m._compress(u,6,function(y){return n.charAt(y)});switch(f.length%4){default:case 0:return f;case 1:return f+"===";case 2:return f+"==";case 3:return f+"="}},decompressFromBase64:function(u){return u==null?"":u==""?null:m._decompress(u.length,32,function(f){return h(n,u.charAt(f))})},compressToUTF16:function(u){return u==null?"":m._compress(u,15,function(f){return r(f+32)})+" "},decompressFromUTF16:function(u){return u==null?"":u==""?null:m._decompress(u.length,16384,function(f){return u.charCodeAt(f)-32})},compressToUint8Array:function(u){for(var f=m.compress(u),y=new Uint8Array(f.length*2),g=0,p=f.length;g<p;g++){var w=f.charCodeAt(g);y[g*2]=w>>>8,y[g*2+1]=w%256}return y},decompressFromUint8Array:function(u){if(u==null)return m.decompress(u);for(var f=new Array(u.length/2),y=0,g=f.length;y<g;y++)f[y]=u[y*2]*256+u[y*2+1];var p=[];return f.forEach(function(w){p.push(r(w))}),m.decompress(p.join(""))},compressToEncodedURIComponent:function(u){return u==null?"":m._compress(u,6,function(f){return o.charAt(f)})},decompressFromEncodedURIComponent:function(u){return u==null?"":u==""?null:(u=u.replace(/ /g,"+"),m._decompress(u.length,32,function(f){return h(o,u.charAt(f))}))},compress:function(u){return m._compress(u,16,function(f){return r(f)})},_compress:function(u,f,y){if(u==null)return"";var g,p,w={},S={},T="",F="",b="",v=2,_=3,A=2,s=[],i=0,a=0,d;for(d=0;d<u.length;d+=1)if(T=u.charAt(d),Object.prototype.hasOwnProperty.call(w,T)||(w[T]=_++,S[T]=!0),F=b+T,Object.prototype.hasOwnProperty.call(w,F))b=F;else{if(Object.prototype.hasOwnProperty.call(S,b)){if(b.charCodeAt(0)<256){for(g=0;g<A;g++)i=i<<1,a==f-1?(a=0,s.push(y(i)),i=0):a++;for(p=b.charCodeAt(0),g=0;g<8;g++)i=i<<1|p&1,a==f-1?(a=0,s.push(y(i)),i=0):a++,p=p>>1}else{for(p=1,g=0;g<A;g++)i=i<<1|p,a==f-1?(a=0,s.push(y(i)),i=0):a++,p=0;for(p=b.charCodeAt(0),g=0;g<16;g++)i=i<<1|p&1,a==f-1?(a=0,s.push(y(i)),i=0):a++,p=p>>1}v--,v==0&&(v=Math.pow(2,A),A++),delete S[b]}else for(p=w[b],g=0;g<A;g++)i=i<<1|p&1,a==f-1?(a=0,s.push(y(i)),i=0):a++,p=p>>1;v--,v==0&&(v=Math.pow(2,A),A++),w[F]=_++,b=String(T)}if(b!==""){if(Object.prototype.hasOwnProperty.call(S,b)){if(b.charCodeAt(0)<256){for(g=0;g<A;g++)i=i<<1,a==f-1?(a=0,s.push(y(i)),i=0):a++;for(p=b.charCodeAt(0),g=0;g<8;g++)i=i<<1|p&1,a==f-1?(a=0,s.push(y(i)),i=0):a++,p=p>>1}else{for(p=1,g=0;g<A;g++)i=i<<1|p,a==f-1?(a=0,s.push(y(i)),i=0):a++,p=0;for(p=b.charCodeAt(0),g=0;g<16;g++)i=i<<1|p&1,a==f-1?(a=0,s.push(y(i)),i=0):a++,p=p>>1}v--,v==0&&(v=Math.pow(2,A),A++),delete S[b]}else for(p=w[b],g=0;g<A;g++)i=i<<1|p&1,a==f-1?(a=0,s.push(y(i)),i=0):a++,p=p>>1;v--,v==0&&(v=Math.pow(2,A),A++)}for(p=2,g=0;g<A;g++)i=i<<1|p&1,a==f-1?(a=0,s.push(y(i)),i=0):a++,p=p>>1;for(;;)if(i=i<<1,a==f-1){s.push(y(i));break}else a++;return s.join("")},decompress:function(u){return u==null?"":u==""?null:m._decompress(u.length,32768,function(f){return u.charCodeAt(f)})},_decompress:function(u,f,y){var g=[],p=4,w=4,S=3,T="",F=[],b,v,_,A,s,i,a,d={val:y(0),position:f,index:1};for(b=0;b<3;b+=1)g[b]=b;for(_=0,s=Math.pow(2,2),i=1;i!=s;)A=d.val&d.position,d.position>>=1,d.position==0&&(d.position=f,d.val=y(d.index++)),_|=(A>0?1:0)*i,i<<=1;switch(_){case 0:for(_=0,s=Math.pow(2,8),i=1;i!=s;)A=d.val&d.position,d.position>>=1,d.position==0&&(d.position=f,d.val=y(d.index++)),_|=(A>0?1:0)*i,i<<=1;a=r(_);break;case 1:for(_=0,s=Math.pow(2,16),i=1;i!=s;)A=d.val&d.position,d.position>>=1,d.position==0&&(d.position=f,d.val=y(d.index++)),_|=(A>0?1:0)*i,i<<=1;a=r(_);break;case 2:return""}for(g[3]=a,v=a,F.push(a);;){if(d.index>u)return"";for(_=0,s=Math.pow(2,S),i=1;i!=s;)A=d.val&d.position,d.position>>=1,d.position==0&&(d.position=f,d.val=y(d.index++)),_|=(A>0?1:0)*i,i<<=1;switch(a=_){case 0:for(_=0,s=Math.pow(2,8),i=1;i!=s;)A=d.val&d.position,d.position>>=1,d.position==0&&(d.position=f,d.val=y(d.index++)),_|=(A>0?1:0)*i,i<<=1;g[w++]=r(_),a=w-1,p--;break;case 1:for(_=0,s=Math.pow(2,16),i=1;i!=s;)A=d.val&d.position,d.position>>=1,d.position==0&&(d.position=f,d.val=y(d.index++)),_|=(A>0?1:0)*i,i<<=1;g[w++]=r(_),a=w-1,p--;break;case 2:return F.join("")}if(p==0&&(p=Math.pow(2,S),S++),g[a])T=g[a];else if(a===w)T=v+v.charAt(0);else return null;F.push(T),g[w++]=v+T.charAt(0),p--,v=T,p==0&&(p=Math.pow(2,S),S++)}}};return m}();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})}(z)),z.exports}var it=ot();const st=nt(it);class at{constructor(){ge(this,M);ge(this,U,new AbortController)}get signal(){return J(this,M)?J(this,U).signal:(Pe(this,M,setInterval(()=>{lt()&&(J(this,U).abort(),clearInterval(J(this,M)))},200)),J(this,U).signal)}get promise(){return new Promise(e=>{this.addListener(e)})}addListener(e,{signal:r}={}){if(this.signal.aborted&&!(r!=null&&r.aborted)){setTimeout(e,0);return}this.signal.addEventListener("abort",e,{once:!0,signal:r})}}M=new WeakMap,U=new WeakMap;const ct=new at,lt=()=>{var t;return!((t=chrome.runtime)!=null&&t.id)};new EventTarget,((Me=globalThis.browser)==null?void 0:Me.storage)??((Ue=globalThis.chrome)==null||Ue.storage);async function ut(){}setTimeout(ut,2);const ft=Object.prototype.toString,dt="[object Uint8Array]";function ht(t,e,r){return t?t.constructor===e?!0:ft.call(t)===r:!1}function gt(t){return ht(t,Uint8Array,dt)}function pt(t){if(!gt(t))throw new TypeError(`Expected \`Uint8Array\`, got \`${typeof t}\``)}new globalThis.TextDecoder("utf8");function Te(t){if(typeof t!="string")throw new TypeError(`Expected \`string\`, got \`${typeof t}\``)}const mt=new globalThis.TextEncoder;function yt(t){return Te(t),mt.encode(t)}function At(t){return t.replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const wt=65535;function bt(t,{urlSafe:e=!1}={}){pt(t);let r;if(t.length<wt)r=globalThis.btoa(String.fromCodePoint.apply(this,t));else{r="";for(const n of t)r+=String.fromCodePoint(n);r=globalThis.btoa(r)}return e?At(r):r}function vt(t,{urlSafe:e=!1}={}){return Te(t),bt(yt(t),{urlSafe:e})}Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));const Ee={types:[{accept:{"application/json":".json"}}]},Se=typeof showOpenFilePicker=="function";async function _t(){const t=document.createElement("input");t.type="file",t.accept=".json";const e=new Promise(o=>{t.addEventListener("change",o,{once:!0})});t.click();const n=(await e).target.files[0];if(!n)throw new Error("No file selected");return n.text()}async function kt(t,e){const r=`data:application/json;base64,${vt(t)}`,n=document.createElement("a");n.download=e,n.href=r,n.click()}async function Tt(){const[t]=await showOpenFilePicker(Ee);return(await t.getFile()).text()}async function Et(t,e){const n=await(await showSaveFilePicker({...Ee,suggestedName:e})).createWritable();await n.write(t),await n.close()}const St=Se?Tt:_t,xt=Se?Et:kt,{compressToEncodedURIComponent:Ct,decompressFromEncodedURIComponent:Bt}=st;function xe(t){throw alert(t),new Error(t)}async function Ft(){var e;const t=await((e=me.management)==null?void 0:e.getSelf());return(t==null?void 0:t.installType)==="development"?!0:new Promise(r=>{chrome.runtime.onInstalled.addListener(()=>{r(!0)}),setTimeout(r,500,!1)})}class ae{constructor({defaults:e={},storageName:r="options",migrations:n=[],logging:o=!0,storageType:c="sync"}={}){k(this,"storageName");k(this,"storageType");k(this,"defaults");k(this,"_form");k(this,"_migrations");k(this,"importFromFile",async()=>{const e=await St();let r;try{r=JSON.parse(e)}catch{xe("The file is not a valid JSON file.")}this._jsonIdentityHelper in r||xe("The file selected is not a valid recognized options file."),delete r[this._jsonIdentityHelper],await this.set(r),this._form&&this._updateForm(this._form,r)});k(this,"exportToFile",async()=>{const e=chrome.runtime.getManifest(),r=JSON.stringify({[this._jsonIdentityHelper]:e.name,...await this.getAll()},null,"	");await xt(r,e.name+" options.json")});k(this,"_handleFormInput",Z(300,async({target:e})=>{const r=e;if(r.name){try{await this.set(this._parseForm(r.form))}catch(n){throw r.dispatchEvent(new CustomEvent("options-sync:save-error",{bubbles:!0,detail:n})),n}r.dispatchEvent(new CustomEvent("options-sync:save-success",{bubbles:!0})),r.form.dispatchEvent(new CustomEvent("options-sync:form-synced",{bubbles:!0}))}}));k(this,"_handleStorageChangeOnForm",(e,r)=>{r===this.storageType&&this.storageName in e&&(!document.hasFocus()||!this._form.contains(document.activeElement))&&this._updateForm(this._form,this._decode(e[this.storageName].newValue))});this.storageName=r,this.defaults=e,this.storageType=c,o||(this._log=()=>{}),this._migrations=this._runMigrations(n)}get storage(){return me.storage[this.storageType]}async getAll(){return await this._migrations,this._getAll()}async setAll(e){return await this._migrations,this._setAll(e)}async set(e){return this.setAll({...await this.getAll(),...e})}async syncForm(e){var r,n;this.stopSyncForm(),this._form=e instanceof HTMLFormElement?e:document.querySelector(e),this._form.addEventListener("input",this._handleFormInput),this._form.addEventListener("submit",this._handleFormSubmit),chrome.storage.onChanged.addListener(this._handleStorageChangeOnForm),this._updateForm(this._form,await this.getAll()),(r=this._form.querySelector(".js-export"))==null||r.addEventListener("click",this.exportToFile),(n=this._form.querySelector(".js-import"))==null||n.addEventListener("click",this.importFromFile),ct.addListener(()=>{location.reload()})}stopSyncForm(){var e,r;this._form&&(this._form.removeEventListener("input",this._handleFormInput),this._form.removeEventListener("submit",this._handleFormSubmit),(e=this._form.querySelector(".js-export"))==null||e.removeEventListener("click",this.exportToFile),(r=this._form.querySelector(".js-import"))==null||r.removeEventListener("click",this.importFromFile),chrome.storage.onChanged.removeListener(this._handleStorageChangeOnForm),delete this._form)}get _jsonIdentityHelper(){return"__webextOptionsSync"}onChanged(e,r){const n=(o,c)=>{const h=o[this.storageName];h&&c===this.storageType&&e(this._decode(h.newValue),this._decode(h.oldValue??{}))};chrome.storage.onChanged.addListener(n),r==null||r.addEventListener("abort",()=>{chrome.storage.onChanged.removeListener(n)})}_log(e,...r){console[e](...r)}async _getAll(){const e=await this.storage.get(this.storageName);return this._decode(e[this.storageName])}async _setAll(e){this._log("log","Saving options",e),await this.storage.set({[this.storageName]:this._encode(e)})}_encode(e){const r={...e};for(const[n,o]of Object.entries(r))this.defaults[n]===o&&delete r[n];return this._log("log","Without the default values",r),Ct(JSON.stringify(r))}_decode(e){let r=e;return typeof e=="string"&&(r=JSON.parse(Bt(e))),{...this.defaults,...r}}async _runMigrations(e){if(e.length===0||!He()||!await Ft())return;const r=await this._getAll(),n=JSON.stringify(r);this._log("log","Found these stored options",{...r}),this._log("info","Will run",e.length,e.length===1?"migration":" migrations");for(const o of e)await o(r,this.defaults);n!==JSON.stringify(r)&&await this._setAll(r)}_handleFormSubmit(e){e.preventDefault()}_updateForm(e,r){const n=this._parseForm(e);for(const[c,h]of Object.entries(r))n[c]===h&&delete r[c];const o=Object.keys(r);o.length>0&&rt(e,r,{include:o})}_parseForm(e){const r=[];for(const n of e.querySelectorAll("[name]"))n.validity.valid&&!n.disabled&&r.push(n.name.replace(/\[.*]/,""));return Xe(e,{include:r})}}k(ae,"migrations",{removeUnused(e,r){for(const n of Object.keys(e))n in r||delete e[n]}});const Rt=new ae({defaults:{githubToken:"",gistID:"",gistFileName:"BookmarkHub",enableNotify:!0,githubURL:"https://api.github.com",enableAutoSync:!1},migrations:[(t,e)=>{},ae.migrations.removeUnused],logging:!1});class Ot{constructor(){k(this,"githubToken","");k(this,"gistID","");k(this,"gistFileName","BookmarkHub");k(this,"enableNotify",!0);k(this,"githubURL","https://api.github.com");k(this,"enableAutoSync",!1)}}class I extends Ot{constructor(){super()}static async build(){let e=await Rt.getAll(),r=new I;return r.gistID=e.gistID,r.gistFileName=e.gistFileName,r.githubToken=e.githubToken,r.enableNotify=e.enableNotify,r.enableAutoSync=e.enableAutoSync,r}}class Ce extends Error{constructor(r,n,o){const c=r.status||r.status===0?r.status:"",h=r.statusText||"",m=`${c} ${h}`.trim(),u=m?`status code ${m}`:"an unknown error";super(`Request failed with ${u}: ${n.method} ${n.url}`);k(this,"response");k(this,"request");k(this,"options");this.name="HTTPError",this.response=r,this.request=n,this.options=o}}class Be extends Error{constructor(r){super(`Request timed out: ${r.method} ${r.url}`);k(this,"request");this.name="TimeoutError",this.request=r}}const H=t=>t!==null&&typeof t=="object",X=(...t)=>{for(const e of t)if((!H(e)||Array.isArray(e))&&e!==void 0)throw new TypeError("The `options` argument must be an object");return ce({},...t)},Fe=(t={},e={})=>{const r=new globalThis.Headers(t),n=e instanceof globalThis.Headers,o=new globalThis.Headers(e);for(const[c,h]of o.entries())n&&h==="undefined"||h===void 0?r.delete(c):r.set(c,h);return r};function W(t,e,r){return Object.hasOwn(e,r)&&e[r]===void 0?[]:ce(t[r]??[],e[r]??[])}const Re=(t={},e={})=>({beforeRequest:W(t,e,"beforeRequest"),beforeRetry:W(t,e,"beforeRetry"),afterResponse:W(t,e,"afterResponse"),beforeError:W(t,e,"beforeError")}),ce=(...t)=>{let e={},r={},n={};for(const o of t)if(Array.isArray(o))Array.isArray(e)||(e=[]),e=[...e,...o];else if(H(o)){for(let[c,h]of Object.entries(o))H(h)&&c in e&&(h=ce(e[c],h)),e={...e,[c]:h};H(o.hooks)&&(n=Re(n,o.hooks),e.hooks=n),H(o.headers)&&(r=Fe(r,o.headers),e.headers=r)}return e},Nt=(()=>{let t=!1,e=!1;const r=typeof globalThis.ReadableStream=="function",n=typeof globalThis.Request=="function";if(r&&n)try{e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type")}catch(o){if(o instanceof Error&&o.message==="unsupported BodyInit type")return!1;throw o}return t&&!e})(),It=typeof globalThis.AbortController=="function",Dt=typeof globalThis.ReadableStream=="function",Lt=typeof globalThis.FormData=="function",Oe=["get","post","put","patch","head","delete"],Mt={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},le=2147483647,Ne=Symbol("stop"),Ut={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},qt={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0},Jt=t=>Oe.includes(t)?t.toUpperCase():t,Ie={limit:2,methods:["get","put","head","delete","options","trace"],statusCodes:[408,413,429,500,502,503,504],afterStatusCodes:[413,429,503],maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:t=>.3*2**(t-1)*1e3},Pt=(t={})=>{if(typeof t=="number")return{...Ie,limit:t};if(t.methods&&!Array.isArray(t.methods))throw new Error("retry.methods must be an array");if(t.statusCodes&&!Array.isArray(t.statusCodes))throw new Error("retry.statusCodes must be an array");return{...Ie,...t}};async function Ht(t,e,r,n){return new Promise((o,c)=>{const h=setTimeout(()=>{r&&r.abort(),c(new Be(t))},n.timeout);n.fetch(t,e).then(o).catch(c).then(()=>{clearTimeout(h)})})}async function Qt(t,{signal:e}){return new Promise((r,n)=>{e&&(e.throwIfAborted(),e.addEventListener("abort",o,{once:!0}));function o(){clearTimeout(c),n(e.reason)}const c=setTimeout(()=>{e==null||e.removeEventListener("abort",o),r()},t)})}const jt=(t,e)=>{const r={};for(const n in e)!(n in qt)&&!(n in Ut)&&!(n in t)&&(r[n]=e[n]);return r};class ${constructor(e,r={}){k(this,"request");k(this,"abortController");k(this,"_retryCount",0);k(this,"_input");k(this,"_options");var n,o;if(this._input=e,this._options={...r,headers:Fe(this._input.headers,r.headers),hooks:Re({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},r.hooks),method:Jt(r.method??this._input.method),prefixUrl:String(r.prefixUrl||""),retry:Pt(r.retry),throwHttpErrors:r.throwHttpErrors!==!1,timeout:r.timeout??1e4,fetch:r.fetch??globalThis.fetch.bind(globalThis)},typeof this._input!="string"&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&typeof this._input=="string"){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(It){this.abortController=new globalThis.AbortController;const c=this._options.signal??this._input.signal;c==null||c.addEventListener("abort",()=>{this.abortController.abort(c.reason)}),this._options.signal=this.abortController.signal}if(Nt&&(this._options.duplex="half"),this._options.json!==void 0&&(this._options.body=((o=(n=this._options).stringifyJson)==null?void 0:o.call(n,this._options.json))??JSON.stringify(this._options.json),this._options.headers.set("content-type",this._options.headers.get("content-type")??"application/json")),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){const h="?"+(typeof this._options.searchParams=="string"?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString()),m=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,h);(Lt&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(m,{...this.request}),this._options)}}static create(e,r){const n=new $(e,r),o=async()=>{if(typeof n._options.timeout=="number"&&n._options.timeout>le)throw new RangeError(`The \`timeout\` option cannot be greater than ${le}`);await Promise.resolve();let m=await n._fetch();for(const u of n._options.hooks.afterResponse){const f=await u(n.request,n._options,n._decorateResponse(m.clone()));f instanceof globalThis.Response&&(m=f)}if(n._decorateResponse(m),!m.ok&&n._options.throwHttpErrors){let u=new Ce(m,n.request,n._options);for(const f of n._options.hooks.beforeError)u=await f(u);throw u}if(n._options.onDownloadProgress){if(typeof n._options.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!Dt)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return n._stream(m.clone(),n._options.onDownloadProgress)}return m},h=n._options.retry.methods.includes(n.request.method.toLowerCase())?n._retry(o):o();for(const[m,u]of Object.entries(Mt))h[m]=async()=>{n.request.headers.set("accept",n.request.headers.get("accept")||u);const f=await h;if(m==="json"){if(f.status===204||(await f.clone().arrayBuffer()).byteLength===0)return"";if(r.parseJson)return r.parseJson(await f.text())}return f[m]()};return h}_calculateRetryDelay(e){if(this._retryCount++,this._retryCount>this._options.retry.limit||e instanceof Be)throw e;if(e instanceof Ce){if(!this._options.retry.statusCodes.includes(e.response.status))throw e;const n=e.response.headers.get("Retry-After")??e.response.headers.get("RateLimit-Reset")??e.response.headers.get("X-RateLimit-Reset")??e.response.headers.get("X-Rate-Limit-Reset");if(n&&this._options.retry.afterStatusCodes.includes(e.response.status)){let o=Number(n)*1e3;Number.isNaN(o)?o=Date.parse(n)-Date.now():o>=Date.parse("2024-01-01")&&(o-=Date.now());const c=this._options.retry.maxRetryAfter??o;return o<c?o:c}if(e.response.status===413)throw e}const r=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,r)}_decorateResponse(e){return this._options.parseJson&&(e.json=async()=>this._options.parseJson(await e.text())),e}async _retry(e){try{return await e()}catch(r){const n=Math.min(this._calculateRetryDelay(r),le);if(this._retryCount<1)throw r;await Qt(n,{signal:this._options.signal});for(const o of this._options.hooks.beforeRetry)if(await o({request:this.request,options:this._options,error:r,retryCount:this._retryCount})===Ne)return;return this._retry(e)}}async _fetch(){for(const n of this._options.hooks.beforeRequest){const o=await n(this.request,this._options);if(o instanceof Request){this.request=o;break}if(o instanceof Response)return o}const e=jt(this.request,this._options),r=this.request;return this.request=r.clone(),this._options.timeout===!1?this._options.fetch(r,e):Ht(r,e,this.abortController,this._options)}_stream(e,r){const n=Number(e.headers.get("content-length"))||0;let o=0;return e.status===204?(r&&r({percent:1,totalBytes:n,transferredBytes:o},new Uint8Array),new globalThis.Response(null,{status:e.status,statusText:e.statusText,headers:e.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(c){const h=e.body.getReader();r&&r({percent:0,transferredBytes:0,totalBytes:n},new Uint8Array);async function m(){const{done:u,value:f}=await h.read();if(u){c.close();return}if(r){o+=f.byteLength;const y=n===0?0:o/n;r({percent:y,transferredBytes:o,totalBytes:n},f)}c.enqueue(f),await m()}await m()}}),{status:e.status,statusText:e.statusText,headers:e.headers})}}/*! MIT License © Sindre Sorhus */const ue=t=>{const e=(r,n)=>$.create(r,X(t,n));for(const r of Oe)e[r]=(n,o)=>$.create(n,X(t,o,{method:r}));return e.create=r=>ue(X(r)),e.extend=r=>(typeof r=="function"&&(r=r(t??{})),ue(X(t,r))),e.stop=Ne,e},ee=ue().create({prefixUrl:"https://api.github.com",timeout:6e4,retry:1,hooks:{beforeRequest:[async t=>{let e=await I.build();t.headers.set("Authorization",`Bearer ${e.githubToken}`),t.headers.set("Content-Type","application/json;charset=utf-8"),t.headers.set("X-GitHub-Api-Version","2022-11-28"),t.headers.set("Accept","application/vnd.github+json"),t.headers.set("cache","no-store")}]}});class Yt{async get(){let e=await I.build(),r=await ee.get(`gists/${e.gistID}`).json();if(r!=null&&r.files&&Object.keys(r.files).indexOf(e.gistFileName)!==-1){let o=r.files[e.gistFileName];return o.truncated?ee.get(o.raw_url,{prefixUrl:""}).text():o.content}return null}async getAllGist(){return ee.get("gists").json()}async update(e){let r=await I.build();return ee.patch(`gists/${r.gistID}`,{json:e}).json()}}const Q=new Yt,j="data:image/png;base64,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";class fe{constructor(){k(this,"browser","chrome");k(this,"version","1.0.0");k(this,"createDate",Date.now());k(this,"bookmarks",[])}}var Y=(t=>(t[t.FIREFOX=0]="FIREFOX",t[t.CHROME=1]="CHROME",t[t.EDGE=2]="EDGE",t))(Y||{}),N=(t=>(t[t.NONE=0]="NONE",t[t.SYNC=1]="SYNC",t[t.CHANGE=2]="CHANGE",t[t.CREATE=3]="CREATE",t[t.MOVE=4]="MOVE",t[t.REMOVE=5]="REMOVE",t))(N||{}),O=(t=>(t.MenuFolder="MenuFolder",t.ToolbarFolder="ToolbarFolder",t.UnfiledFolder="UnfiledFolder",t.MobileFolder="MobileFolder",t))(O||{});const Zt=E(()=>{l.runtime.onInstalled.addListener(s=>{v()});let t=N.NONE,e=Y.CHROME,r=null,n=0,o=!1;const c=3e3,h="✓",m="!",u="↻";l.runtime.onMessage.addListener((s,i,a)=>(s.name==="upload"&&(t=N.SYNC,f().then(()=>{t=N.NONE,l.action.setBadgeText({text:""}),T(),a(!0)})),s.name==="download"&&(t=N.SYNC,y().then(()=>{t=N.NONE,l.action.setBadgeText({text:""}),T(),a(!0)})),s.name==="removeAll"&&(t=N.REMOVE,p().then(()=>{t=N.NONE,l.action.setBadgeText({text:""}),T(),a(!0)})),s.name==="setting"&&l.runtime.openOptionsPage().then(()=>{a(!0)}),s.name==="updateAutoSync"&&v().then(()=>{a(!0)}),!0)),l.bookmarks.onCreated.addListener(async(s,i)=>{t===N.NONE&&(l.action.setBadgeText({text:m}),l.action.setBadgeBackgroundColor({color:"#FFA500"}),T(),await _())}),l.bookmarks.onChanged.addListener(async(s,i)=>{t===N.NONE&&(l.action.setBadgeText({text:m}),l.action.setBadgeBackgroundColor({color:"#FFA500"}),await _())}),l.bookmarks.onMoved.addListener(async(s,i)=>{t===N.NONE&&(l.action.setBadgeText({text:m}),l.action.setBadgeBackgroundColor({color:"#FFA500"}),await _())}),l.bookmarks.onRemoved.addListener(async(s,i)=>{t===N.NONE&&(l.action.setBadgeText({text:m}),l.action.setBadgeBackgroundColor({color:"#FFA500"}),T(),await _())});async function f(){try{let s=await I.build();if(s.githubToken=="")throw new Error("Gist Token Not Found");if(s.gistID=="")throw new Error("Gist ID Not Found");if(s.gistFileName=="")throw new Error("Gist File Not Found");let i=await g(),a=new fe;a.version=l.runtime.getManifest().version,a.createDate=Date.now(),a.bookmarks=F(i),a.browser=navigator.userAgent,await Q.update({files:{[s.gistFileName]:{content:JSON.stringify(a)}},description:s.gistFileName});const d=S(a.bookmarks);await l.storage.local.set({remoteCount:d}),l.action.setBadgeText({text:h}),l.action.setBadgeBackgroundColor({color:"#00AA00"}),setTimeout(()=>{l.action.setBadgeText({text:""})},2e3)}catch(s){console.error(s),await l.notifications.create({type:"basic",iconUrl:j,title:l.i18n.getMessage("uploadBookmarks"),message:`${l.i18n.getMessage("error")}：${s.message}`})}}async function y(){try{let s=await Q.get(),i=await I.build();if(s){let a=JSON.parse(s);if(a.bookmarks==null||a.bookmarks.length==0){i.enableNotify&&await l.notifications.create({type:"basic",iconUrl:j,title:l.i18n.getMessage("downloadBookmarks"),message:`${l.i18n.getMessage("error")}：Gist File ${i.gistFileName} is NULL`});return}await p(),await w(a.bookmarks);const d=S(a.bookmarks);await l.storage.local.set({remoteCount:d}),l.action.setBadgeText({text:h}),l.action.setBadgeBackgroundColor({color:"#00AA00"}),setTimeout(()=>{l.action.setBadgeText({text:""})},2e3)}else await l.notifications.create({type:"basic",iconUrl:j,title:l.i18n.getMessage("downloadBookmarks"),message:`${l.i18n.getMessage("error")}：Gist File ${i.gistFileName} Not Found`})}catch(s){console.error(s),await l.notifications.create({type:"basic",iconUrl:j,title:l.i18n.getMessage("downloadBookmarks"),message:`${l.i18n.getMessage("error")}：${s.message}`})}}async function g(){let s=await l.bookmarks.getTree();return s&&s[0].id==="root________"?e=Y.FIREFOX:e=Y.CHROME,s}async function p(){var s;try{let i=await I.build();if(i.githubToken=="")throw new Error("Gist Token Not Found");if(i.gistID=="")throw new Error("Gist ID Not Found");if(i.gistFileName=="")throw new Error("Gist File Not Found");let a=await g(),d=[];if((s=a[0].children)==null||s.forEach(D=>{var B;(B=D.children)==null||B.forEach(q=>{d.push(q)})}),d.length>0)for(let D of d)D.id&&await l.bookmarks.removeTree(D.id);t===N.REMOVE&&(l.action.setBadgeText({text:h}),l.action.setBadgeBackgroundColor({color:"#00AA00"}),setTimeout(()=>{l.action.setBadgeText({text:""})},2e3))}catch(i){console.error(i),await l.notifications.create({type:"basic",iconUrl:j,title:l.i18n.getMessage("removeAllBookmarks"),message:`${l.i18n.getMessage("error")}：${i.message}`})}}async function w(s){var i,a,d,D,B,q,re,ne,L;if(s!=null)for(let he=0;he<s.length;he++){let x=s[he];if(x.title==O.MenuFolder||x.title==O.MobileFolder||x.title==O.ToolbarFolder||x.title==O.UnfiledFolder){if(e==Y.FIREFOX)switch(x.title){case O.MenuFolder:(i=x.children)==null||i.forEach(C=>C.parentId="menu________");break;case O.MobileFolder:(a=x.children)==null||a.forEach(C=>C.parentId="mobile______");break;case O.ToolbarFolder:(d=x.children)==null||d.forEach(C=>C.parentId="toolbar_____");break;case O.UnfiledFolder:(D=x.children)==null||D.forEach(C=>C.parentId="unfiled_____");break;default:(B=x.children)==null||B.forEach(C=>C.parentId="unfiled_____");break}else switch(x.title){case O.MobileFolder:(q=x.children)==null||q.forEach(C=>C.parentId="3");break;case O.ToolbarFolder:(re=x.children)==null||re.forEach(C=>C.parentId="1");break;case O.UnfiledFolder:case O.MenuFolder:(ne=x.children)==null||ne.forEach(C=>C.parentId="2");break;default:(L=x.children)==null||L.forEach(C=>C.parentId="2");break}await w(x.children);continue}let oe={id:"",title:""};try{oe=await l.bookmarks.create({parentId:x.parentId,title:x.title,url:x.url})}catch(C){console.error(oe,C)}oe.id&&x.children&&x.children.length>0&&(x.children.forEach(C=>C.parentId=oe.id),await w(x.children))}}function S(s){let i=0;return s&&s.forEach(a=>{a.url?i=i+1:i=i+S(a.children)}),i}async function T(){let s=await g();const i=S(s);await l.storage.local.set({localCount:i})}function F(s){if(s[0].children)for(let a of s[0].children)switch(a.id){case"1":case"toolbar_____":a.title=O.ToolbarFolder;break;case"menu________":a.title=O.MenuFolder;break;case"2":case"unfiled_____":a.title=O.UnfiledFolder;break;case"3":case"mobile______":a.title=O.MobileFolder;break}return b(s[0]).children}function b(s){var i;return s.dateAdded=void 0,s.dateGroupModified=void 0,s.id=void 0,s.index=void 0,s.parentId=void 0,s.type=void 0,s.unmodifiable=void 0,s.children&&s.children.length>0&&((i=s.children)==null||i.map(a=>b(a))),s}async function v(){r&&(clearTimeout(r),r=null);const s=await I.build();s.enableAutoSync&&s.githubToken&&s.gistID&&await A()}async function _(){const s=await I.build();!s.enableAutoSync||!s.githubToken||!s.gistID||(r&&clearTimeout(r),r=setTimeout(async()=>{await A(),r=null},c))}async function A(){try{const s=await I.build();if(!s.enableAutoSync||!s.githubToken||!s.gistID)return;o=!0,l.action.setBadgeText({text:u}),l.action.setBadgeBackgroundColor({color:"#0000FF"}),t=N.SYNC;const i=await g(),a=S(i),d=F(i),D=await Q.get();if(D){const B=JSON.parse(D),q=S(B.bookmarks),re=JSON.stringify(d),ne=JSON.stringify(B.bookmarks);if(re===ne)console.log("Auto-sync: Already in sync"),n=B.createDate;else if(n>0&&B.createDate>n)console.log("Auto-sync: Downloading newer remote changes"),await p(),await w(B.bookmarks),await l.storage.local.set({remoteCount:q}),n=B.createDate;else{console.log("Auto-sync: Uploading local changes");const L=new fe;L.version=l.runtime.getManifest().version,L.createDate=Date.now(),L.bookmarks=d,L.browser=navigator.userAgent,await Q.update({files:{[s.gistFileName]:{content:JSON.stringify(L)}},description:s.gistFileName}),await l.storage.local.set({remoteCount:a}),n=L.createDate}}else{console.log("Auto-sync: Initial upload");const B=new fe;B.version=l.runtime.getManifest().version,B.createDate=Date.now(),B.bookmarks=d,B.browser=navigator.userAgent,await Q.update({files:{[s.gistFileName]:{content:JSON.stringify(B)}},description:s.gistFileName}),await l.storage.local.set({remoteCount:a}),n=B.createDate}l.action.setBadgeText({text:h}),l.action.setBadgeBackgroundColor({color:"#00AA00"}),setTimeout(()=>{o||l.action.setBadgeText({text:""})},2e3)}catch(s){console.error("Auto-sync error:",s),l.action.setBadgeText({text:"✗"}),l.action.setBadgeBackgroundColor({color:"#FF0000"})}finally{o=!1,t=N.NONE,await T()}}v()});function er(){}function te(t,...e){}const Kt={debug:(...t)=>te(console.debug,...t),log:(...t)=>te(console.log,...t),warn:(...t)=>te(console.warn,...t),error:(...t)=>te(console.error,...t)};let de;try{de=Zt.main(),de instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(t){throw Kt.error("The background crashed on startup!"),t}return de}();
background;
