var background=function(){"use strict";var Gt=Object.defineProperty;var qe=E=>{throw TypeError(E)};var Vt=(E,a,R)=>a in E?Gt(E,a,{enumerable:!0,configurable:!0,writable:!0,value:R}):E[a]=R;var _=(E,a,R)=>Vt(E,typeof a!="symbol"?a+"":a,R),Je=(E,a,R)=>a.has(E)||qe("Cannot "+R);var J=(E,a,R)=>(Je(E,a,"read from private field"),R?R.call(E):a.get(E)),ge=(E,a,R)=>a.has(E)?qe("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(E):a.set(E,R),Pe=(E,a,R,Z)=>(Je(E,a,"write to private field"),Z?Z.call(E,R):a.set(E,R),R);var De,Le,M,U,Me,Ue;function E(t){return t==null||typeof t=="function"?{main:t}:t}const a=((Le=(De=globalThis.browser)==null?void 0:De.runtime)==null?void 0:Le.id)==null?globalThis.chrome:globalThis.browser;function R(t,e,r){var o=r||{},n=o.noTrailing,l=n===void 0?!1:n,d=o.noLeading,m=d===void 0?!1:d,u=o.debounceMode,f=u===void 0?void 0:u,y,g=!1,p=0;function w(){y&&clearTimeout(y)}function S(F){var b=F||{},v=b.upcomingOnly,k=v===void 0?!1:v;w(),g=!k}function T(){for(var F=arguments.length,b=new Array(F),v=0;v<F;v++)b[v]=arguments[v];var k=this,A=Date.now()-p;if(g)return;function s(){p=Date.now(),e.apply(k,b)}function i(){y=void 0}!m&&f&&!y&&s(),w(),f===void 0&&A>t?m?(p=Date.now(),l||(y=setTimeout(f?i:s,t))):s():l!==!0&&(y=setTimeout(f?i:s,f===void 0?t-A:t))}return T.cancel=S,T}function Z(t,e,r){var o={},n=o.atBegin,l=n===void 0?!1:n;return R(t,e,{debounceMode:l!==!1})}function pe(t){return new Proxy(t,{get(e,r){if(e[r])return typeof e[r]!="function"?new pe(e[r]):(...o)=>new Promise((n,l)=>{e[r](...o,d=>{chrome.runtime.lastError?l(new Error(chrome.runtime.lastError.message)):n(d)})})}})}const me=globalThis.chrome&&new pe(globalThis.chrome);function ie(t){if(!t)return!1;try{const{pathname:e}=new URL(t,location.origin);return e===location.pathname}catch{return!1}}function ye(t){var e,r,o;return(o=(r=(e=globalThis.chrome)==null?void 0:e.runtime)==null?void 0:r.getManifest)==null?void 0:o.call(r)}function Ae(t){let e;return()=>(e===void 0&&(e=t()),e)}const He=()=>Qe()||je(),Qe=Ae(()=>{var e,r;const t=ye();return t?ie(t.background_page??((e=t.background)==null?void 0:e.page))?!0:!!((r=t.background)!=null&&r.scripts&&ie("/_generated_background_page.html")):!1}),je=Ae(()=>{var t,e;return ie((e=(t=ye())==null?void 0:t.background)==null?void 0:e.service_worker)});var Ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Ze=function(){function t(e,r){for(var o=0;o<r.length;o++){var n=r[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,r,o){return r&&t(e.prototype,r),o&&t(e,o),e}}(),K=function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},G=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t},V=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};P(this,t),this.registeredTypes=e}return Ze(t,[{key:"get",value:function(r){return typeof this.registeredTypes[r]<"u"?this.registeredTypes[r]:this.registeredTypes.default}},{key:"register",value:function(r,o){typeof this.registeredTypes[r]>"u"&&(this.registeredTypes[r]=o)}},{key:"registerDefault",value:function(r){this.register("default",r)}}]),t}(),we=function(t){K(e,t);function e(r){P(this,e);var o=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return o.registerDefault(function(n){return n.getAttribute("name")||""}),o}return e}(V),Ke=function(t){K(e,t);function e(r){P(this,e);var o=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return o.registerDefault(function(n){return n.value}),o.register("checkbox",function(n){return n.getAttribute("value")!==null?n.checked?n.getAttribute("value"):null:n.checked}),o.register("select",function(n){return Ge(n)}),o}return e}(V);function Ge(t){var e,r,o,n=t.options,l=t.selectedIndex,d=t.type==="select-one",m=d?null:[],u=d?l+1:n.length;for(l<0?o=u:o=d?l:0;o<u;o++)if(r=n[o],(r.selected||o===l)&&!r.disabled&&!(r.parentNode.disabled&&r.parentNode.tagName.toLowerCase()==="optgroup")){if(e=r.value,d)return e;m.push(e)}return m}var Ve=function(t){K(e,t);function e(r){P(this,e);var o=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return o.registerDefault(function(){return!0}),o.register("radio",function(n){return n.checked}),o}return e}(V);function ze(t){var e=t.match(/[^[\]]+/g),r=void 0;return t.length>1&&t.indexOf("[]")===t.length-2&&(r=e.pop(),e.push([r])),e}function se(t){var e=void 0,r=t.tagName,o=r;return r.toLowerCase()==="input"&&(e=t.getAttribute("type"),e?o=e:o="text"),o.toLowerCase()}function be(t,e){return Array.prototype.filter.call(t.querySelectorAll("input,select,textarea"),function(r){if(r.tagName.toLowerCase()==="input"&&(r.type==="submit"||r.type==="reset"))return!1;var o=se(r),n=e.keyExtractors.get(o),l=n(r),d=(e.include||[]).indexOf(l)!==-1,m=(e.exclude||[]).indexOf(l)!==-1,u=!1,f=!1;if(e.ignoredTypes){var y=!0,g=!1,p=void 0;try{for(var w=e.ignoredTypes[Symbol.iterator](),S;!(y=(S=w.next()).done);y=!0){var T=S.value;r.matches(T)&&(u=!0)}}catch(F){g=!0,p=F}finally{try{!y&&w.return&&w.return()}finally{if(g)throw p}}}return d?f=!1:e.include?f=!0:f=m||u,!f})}function ve(t,e,r){if(!e)return t;var o=e.shift();return t[o]||(t[o]=Array.isArray(o)?[]:{}),e.length===0&&(Array.isArray(t[o])?r!==null&&t[o].push(r):t[o]=r),e.length>0&&ve(t[o],e,r),t}function Xe(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={};return e.keySplitter=e.keySplitter||ze,e.keyExtractors=new we(e.keyExtractors||{}),e.inputReaders=new Ke(e.inputReaders||{}),e.keyAssignmentValidators=new Ve(e.keyAssignmentValidators||{}),Array.prototype.forEach.call(be(t,e),function(o){var n=se(o),l=e.keyExtractors.get(n),d=l(o),m=e.inputReaders.get(n),u=m(o),f=e.keyAssignmentValidators.get(n);if(f(o,d,u)){var y=e.keySplitter(d);r=ve(r,y,u)}}),r}var We=function(t){K(e,t);function e(r){P(this,e);var o=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return o.registerDefault(function(n,l){n.value=l}),o.register("checkbox",function(n,l){l===null?n.indeterminate=!0:n.checked=Array.isArray(l)?l.indexOf(n.value)!==-1:l}),o.register("radio",function(n,l){l!==void 0&&(n.checked=n.value===l.toString())}),o.register("select",et),o}return e}(V);function $e(t){var e=[];return t!==null&&(Array.isArray(t)?e.push.apply(e,t):e.push(t)),e}function et(t,e){for(var r,o,n=t.options,l=$e(e),d=n.length;d--;)o=n[d],l.indexOf(o.value)>-1&&(o.setAttribute("selected",!0),r=!0);r||(t.selectedIndex=-1)}function tt(t,e){return t+"["+e+"]"}function ke(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o={},n=r.keyJoiner||tt;for(var l in t)if(t.hasOwnProperty(l)){var d=t[l],m={};e&&(l=n(e,l)),Array.isArray(d)?(m[l+"[]"]=d,m[l]=d):(typeof d>"u"?"undefined":Ye(d))==="object"?m=ke(d,l,r):m[l]=d,Object.assign(o,m)}return o}function rt(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=ke(e,null,r);r.keyExtractors=new we(r.keyExtractors||{}),r.inputWriters=new We(r.inputWriters||{}),Array.prototype.forEach.call(be(t,r),function(n){var l=se(n),d=r.keyExtractors.get(l),m=d(n),u=r.inputWriters.get(l),f=o[m];u(n,f)})}function ot(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var z={exports:{}};z.exports;var _e;function nt(){return _e||(_e=1,function(t){var e=function(){var r=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",l={};function d(u,f){if(!l[u]){l[u]={};for(var y=0;y<u.length;y++)l[u][u.charAt(y)]=y}return l[u][f]}var m={compressToBase64:function(u){if(u==null)return"";var f=m._compress(u,6,function(y){return o.charAt(y)});switch(f.length%4){default:case 0:return f;case 1:return f+"===";case 2:return f+"==";case 3:return f+"="}},decompressFromBase64:function(u){return u==null?"":u==""?null:m._decompress(u.length,32,function(f){return d(o,u.charAt(f))})},compressToUTF16:function(u){return u==null?"":m._compress(u,15,function(f){return r(f+32)})+" "},decompressFromUTF16:function(u){return u==null?"":u==""?null:m._decompress(u.length,16384,function(f){return u.charCodeAt(f)-32})},compressToUint8Array:function(u){for(var f=m.compress(u),y=new Uint8Array(f.length*2),g=0,p=f.length;g<p;g++){var w=f.charCodeAt(g);y[g*2]=w>>>8,y[g*2+1]=w%256}return y},decompressFromUint8Array:function(u){if(u==null)return m.decompress(u);for(var f=new Array(u.length/2),y=0,g=f.length;y<g;y++)f[y]=u[y*2]*256+u[y*2+1];var p=[];return f.forEach(function(w){p.push(r(w))}),m.decompress(p.join(""))},compressToEncodedURIComponent:function(u){return u==null?"":m._compress(u,6,function(f){return n.charAt(f)})},decompressFromEncodedURIComponent:function(u){return u==null?"":u==""?null:(u=u.replace(/ /g,"+"),m._decompress(u.length,32,function(f){return d(n,u.charAt(f))}))},compress:function(u){return m._compress(u,16,function(f){return r(f)})},_compress:function(u,f,y){if(u==null)return"";var g,p,w={},S={},T="",F="",b="",v=2,k=3,A=2,s=[],i=0,c=0,h;for(h=0;h<u.length;h+=1)if(T=u.charAt(h),Object.prototype.hasOwnProperty.call(w,T)||(w[T]=k++,S[T]=!0),F=b+T,Object.prototype.hasOwnProperty.call(w,F))b=F;else{if(Object.prototype.hasOwnProperty.call(S,b)){if(b.charCodeAt(0)<256){for(g=0;g<A;g++)i=i<<1,c==f-1?(c=0,s.push(y(i)),i=0):c++;for(p=b.charCodeAt(0),g=0;g<8;g++)i=i<<1|p&1,c==f-1?(c=0,s.push(y(i)),i=0):c++,p=p>>1}else{for(p=1,g=0;g<A;g++)i=i<<1|p,c==f-1?(c=0,s.push(y(i)),i=0):c++,p=0;for(p=b.charCodeAt(0),g=0;g<16;g++)i=i<<1|p&1,c==f-1?(c=0,s.push(y(i)),i=0):c++,p=p>>1}v--,v==0&&(v=Math.pow(2,A),A++),delete S[b]}else for(p=w[b],g=0;g<A;g++)i=i<<1|p&1,c==f-1?(c=0,s.push(y(i)),i=0):c++,p=p>>1;v--,v==0&&(v=Math.pow(2,A),A++),w[F]=k++,b=String(T)}if(b!==""){if(Object.prototype.hasOwnProperty.call(S,b)){if(b.charCodeAt(0)<256){for(g=0;g<A;g++)i=i<<1,c==f-1?(c=0,s.push(y(i)),i=0):c++;for(p=b.charCodeAt(0),g=0;g<8;g++)i=i<<1|p&1,c==f-1?(c=0,s.push(y(i)),i=0):c++,p=p>>1}else{for(p=1,g=0;g<A;g++)i=i<<1|p,c==f-1?(c=0,s.push(y(i)),i=0):c++,p=0;for(p=b.charCodeAt(0),g=0;g<16;g++)i=i<<1|p&1,c==f-1?(c=0,s.push(y(i)),i=0):c++,p=p>>1}v--,v==0&&(v=Math.pow(2,A),A++),delete S[b]}else for(p=w[b],g=0;g<A;g++)i=i<<1|p&1,c==f-1?(c=0,s.push(y(i)),i=0):c++,p=p>>1;v--,v==0&&(v=Math.pow(2,A),A++)}for(p=2,g=0;g<A;g++)i=i<<1|p&1,c==f-1?(c=0,s.push(y(i)),i=0):c++,p=p>>1;for(;;)if(i=i<<1,c==f-1){s.push(y(i));break}else c++;return s.join("")},decompress:function(u){return u==null?"":u==""?null:m._decompress(u.length,32768,function(f){return u.charCodeAt(f)})},_decompress:function(u,f,y){var g=[],p=4,w=4,S=3,T="",F=[],b,v,k,A,s,i,c,h={val:y(0),position:f,index:1};for(b=0;b<3;b+=1)g[b]=b;for(k=0,s=Math.pow(2,2),i=1;i!=s;)A=h.val&h.position,h.position>>=1,h.position==0&&(h.position=f,h.val=y(h.index++)),k|=(A>0?1:0)*i,i<<=1;switch(k){case 0:for(k=0,s=Math.pow(2,8),i=1;i!=s;)A=h.val&h.position,h.position>>=1,h.position==0&&(h.position=f,h.val=y(h.index++)),k|=(A>0?1:0)*i,i<<=1;c=r(k);break;case 1:for(k=0,s=Math.pow(2,16),i=1;i!=s;)A=h.val&h.position,h.position>>=1,h.position==0&&(h.position=f,h.val=y(h.index++)),k|=(A>0?1:0)*i,i<<=1;c=r(k);break;case 2:return""}for(g[3]=c,v=c,F.push(c);;){if(h.index>u)return"";for(k=0,s=Math.pow(2,S),i=1;i!=s;)A=h.val&h.position,h.position>>=1,h.position==0&&(h.position=f,h.val=y(h.index++)),k|=(A>0?1:0)*i,i<<=1;switch(c=k){case 0:for(k=0,s=Math.pow(2,8),i=1;i!=s;)A=h.val&h.position,h.position>>=1,h.position==0&&(h.position=f,h.val=y(h.index++)),k|=(A>0?1:0)*i,i<<=1;g[w++]=r(k),c=w-1,p--;break;case 1:for(k=0,s=Math.pow(2,16),i=1;i!=s;)A=h.val&h.position,h.position>>=1,h.position==0&&(h.position=f,h.val=y(h.index++)),k|=(A>0?1:0)*i,i<<=1;g[w++]=r(k),c=w-1,p--;break;case 2:return F.join("")}if(p==0&&(p=Math.pow(2,S),S++),g[c])T=g[c];else if(c===w)T=v+v.charAt(0);else return null;F.push(T),g[w++]=v+T.charAt(0),p--,v=T,p==0&&(p=Math.pow(2,S),S++)}}};return m}();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})}(z)),z.exports}var it=nt();const st=ot(it);class at{constructor(){ge(this,M);ge(this,U,new AbortController)}get signal(){return J(this,M)?J(this,U).signal:(Pe(this,M,setInterval(()=>{lt()&&(J(this,U).abort(),clearInterval(J(this,M)))},200)),J(this,U).signal)}get promise(){return new Promise(e=>{this.addListener(e)})}addListener(e,{signal:r}={}){if(this.signal.aborted&&!(r!=null&&r.aborted)){setTimeout(e,0);return}this.signal.addEventListener("abort",e,{once:!0,signal:r})}}M=new WeakMap,U=new WeakMap;const ct=new at,lt=()=>{var t;return!((t=chrome.runtime)!=null&&t.id)};new EventTarget,((Me=globalThis.browser)==null?void 0:Me.storage)??((Ue=globalThis.chrome)==null||Ue.storage);async function ut(){}setTimeout(ut,2);const ft=Object.prototype.toString,dt="[object Uint8Array]";function ht(t,e,r){return t?t.constructor===e?!0:ft.call(t)===r:!1}function gt(t){return ht(t,Uint8Array,dt)}function pt(t){if(!gt(t))throw new TypeError(`Expected \`Uint8Array\`, got \`${typeof t}\``)}new globalThis.TextDecoder("utf8");function Te(t){if(typeof t!="string")throw new TypeError(`Expected \`string\`, got \`${typeof t}\``)}const mt=new globalThis.TextEncoder;function yt(t){return Te(t),mt.encode(t)}function At(t){return t.replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const wt=65535;function bt(t,{urlSafe:e=!1}={}){pt(t);let r;if(t.length<wt)r=globalThis.btoa(String.fromCodePoint.apply(this,t));else{r="";for(const o of t)r+=String.fromCodePoint(o);r=globalThis.btoa(r)}return e?At(r):r}function vt(t,{urlSafe:e=!1}={}){return Te(t),bt(yt(t),{urlSafe:e})}Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));const Ee={types:[{accept:{"application/json":".json"}}]},Se=typeof showOpenFilePicker=="function";async function kt(){const t=document.createElement("input");t.type="file",t.accept=".json";const e=new Promise(n=>{t.addEventListener("change",n,{once:!0})});t.click();const o=(await e).target.files[0];if(!o)throw new Error("No file selected");return o.text()}async function _t(t,e){const r=`data:application/json;base64,${vt(t)}`,o=document.createElement("a");o.download=e,o.href=r,o.click()}async function Tt(){const[t]=await showOpenFilePicker(Ee);return(await t.getFile()).text()}async function Et(t,e){const o=await(await showSaveFilePicker({...Ee,suggestedName:e})).createWritable();await o.write(t),await o.close()}const St=Se?Tt:kt,Ct=Se?Et:_t,{compressToEncodedURIComponent:xt,decompressFromEncodedURIComponent:Bt}=st;function Ce(t){throw alert(t),new Error(t)}async function Ft(){var e;const t=await((e=me.management)==null?void 0:e.getSelf());return(t==null?void 0:t.installType)==="development"?!0:new Promise(r=>{chrome.runtime.onInstalled.addListener(()=>{r(!0)}),setTimeout(r,500,!1)})}class ae{constructor({defaults:e={},storageName:r="options",migrations:o=[],logging:n=!0,storageType:l="sync"}={}){_(this,"storageName");_(this,"storageType");_(this,"defaults");_(this,"_form");_(this,"_migrations");_(this,"importFromFile",async()=>{const e=await St();let r;try{r=JSON.parse(e)}catch{Ce("The file is not a valid JSON file.")}this._jsonIdentityHelper in r||Ce("The file selected is not a valid recognized options file."),delete r[this._jsonIdentityHelper],await this.set(r),this._form&&this._updateForm(this._form,r)});_(this,"exportToFile",async()=>{const e=chrome.runtime.getManifest(),r=JSON.stringify({[this._jsonIdentityHelper]:e.name,...await this.getAll()},null,"	");await Ct(r,e.name+" options.json")});_(this,"_handleFormInput",Z(300,async({target:e})=>{const r=e;if(r.name){try{await this.set(this._parseForm(r.form))}catch(o){throw r.dispatchEvent(new CustomEvent("options-sync:save-error",{bubbles:!0,detail:o})),o}r.dispatchEvent(new CustomEvent("options-sync:save-success",{bubbles:!0})),r.form.dispatchEvent(new CustomEvent("options-sync:form-synced",{bubbles:!0}))}}));_(this,"_handleStorageChangeOnForm",(e,r)=>{r===this.storageType&&this.storageName in e&&(!document.hasFocus()||!this._form.contains(document.activeElement))&&this._updateForm(this._form,this._decode(e[this.storageName].newValue))});this.storageName=r,this.defaults=e,this.storageType=l,n||(this._log=()=>{}),this._migrations=this._runMigrations(o)}get storage(){return me.storage[this.storageType]}async getAll(){return await this._migrations,this._getAll()}async setAll(e){return await this._migrations,this._setAll(e)}async set(e){return this.setAll({...await this.getAll(),...e})}async syncForm(e){var r,o;this.stopSyncForm(),this._form=e instanceof HTMLFormElement?e:document.querySelector(e),this._form.addEventListener("input",this._handleFormInput),this._form.addEventListener("submit",this._handleFormSubmit),chrome.storage.onChanged.addListener(this._handleStorageChangeOnForm),this._updateForm(this._form,await this.getAll()),(r=this._form.querySelector(".js-export"))==null||r.addEventListener("click",this.exportToFile),(o=this._form.querySelector(".js-import"))==null||o.addEventListener("click",this.importFromFile),ct.addListener(()=>{location.reload()})}stopSyncForm(){var e,r;this._form&&(this._form.removeEventListener("input",this._handleFormInput),this._form.removeEventListener("submit",this._handleFormSubmit),(e=this._form.querySelector(".js-export"))==null||e.removeEventListener("click",this.exportToFile),(r=this._form.querySelector(".js-import"))==null||r.removeEventListener("click",this.importFromFile),chrome.storage.onChanged.removeListener(this._handleStorageChangeOnForm),delete this._form)}get _jsonIdentityHelper(){return"__webextOptionsSync"}onChanged(e,r){const o=(n,l)=>{const d=n[this.storageName];d&&l===this.storageType&&e(this._decode(d.newValue),this._decode(d.oldValue??{}))};chrome.storage.onChanged.addListener(o),r==null||r.addEventListener("abort",()=>{chrome.storage.onChanged.removeListener(o)})}_log(e,...r){console[e](...r)}async _getAll(){const e=await this.storage.get(this.storageName);return this._decode(e[this.storageName])}async _setAll(e){this._log("log","Saving options",e),await this.storage.set({[this.storageName]:this._encode(e)})}_encode(e){const r={...e};for(const[o,n]of Object.entries(r))this.defaults[o]===n&&delete r[o];return this._log("log","Without the default values",r),xt(JSON.stringify(r))}_decode(e){let r=e;return typeof e=="string"&&(r=JSON.parse(Bt(e))),{...this.defaults,...r}}async _runMigrations(e){if(e.length===0||!He()||!await Ft())return;const r=await this._getAll(),o=JSON.stringify(r);this._log("log","Found these stored options",{...r}),this._log("info","Will run",e.length,e.length===1?"migration":" migrations");for(const n of e)await n(r,this.defaults);o!==JSON.stringify(r)&&await this._setAll(r)}_handleFormSubmit(e){e.preventDefault()}_updateForm(e,r){const o=this._parseForm(e);for(const[l,d]of Object.entries(r))o[l]===d&&delete r[l];const n=Object.keys(r);n.length>0&&rt(e,r,{include:n})}_parseForm(e){const r=[];for(const o of e.querySelectorAll("[name]"))o.validity.valid&&!o.disabled&&r.push(o.name.replace(/\[.*]/,""));return Xe(e,{include:r})}}_(ae,"migrations",{removeUnused(e,r){for(const o of Object.keys(e))o in r||delete e[o]}});const Rt=new ae({defaults:{githubToken:"",gistID:"",gistFileName:"BookmarkHub",enableNotify:!0,githubURL:"https://api.github.com",enableAutoSync:!1},migrations:[(t,e)=>{},ae.migrations.removeUnused],logging:!1});class Ot{constructor(){_(this,"githubToken","");_(this,"gistID","");_(this,"gistFileName","BookmarkHub");_(this,"enableNotify",!0);_(this,"githubURL","https://api.github.com");_(this,"enableAutoSync",!1)}}class I extends Ot{constructor(){super()}static async build(){let e=await Rt.getAll(),r=new I;return r.gistID=e.gistID,r.gistFileName=e.gistFileName,r.githubToken=e.githubToken,r.enableNotify=e.enableNotify,r.enableAutoSync=e.enableAutoSync,r}}class xe extends Error{constructor(r,o,n){const l=r.status||r.status===0?r.status:"",d=r.statusText||"",m=`${l} ${d}`.trim(),u=m?`status code ${m}`:"an unknown error";super(`Request failed with ${u}: ${o.method} ${o.url}`);_(this,"response");_(this,"request");_(this,"options");this.name="HTTPError",this.response=r,this.request=o,this.options=n}}class Be extends Error{constructor(r){super(`Request timed out: ${r.method} ${r.url}`);_(this,"request");this.name="TimeoutError",this.request=r}}const H=t=>t!==null&&typeof t=="object",X=(...t)=>{for(const e of t)if((!H(e)||Array.isArray(e))&&e!==void 0)throw new TypeError("The `options` argument must be an object");return ce({},...t)},Fe=(t={},e={})=>{const r=new globalThis.Headers(t),o=e instanceof globalThis.Headers,n=new globalThis.Headers(e);for(const[l,d]of n.entries())o&&d==="undefined"||d===void 0?r.delete(l):r.set(l,d);return r};function W(t,e,r){return Object.hasOwn(e,r)&&e[r]===void 0?[]:ce(t[r]??[],e[r]??[])}const Re=(t={},e={})=>({beforeRequest:W(t,e,"beforeRequest"),beforeRetry:W(t,e,"beforeRetry"),afterResponse:W(t,e,"afterResponse"),beforeError:W(t,e,"beforeError")}),ce=(...t)=>{let e={},r={},o={};for(const n of t)if(Array.isArray(n))Array.isArray(e)||(e=[]),e=[...e,...n];else if(H(n)){for(let[l,d]of Object.entries(n))H(d)&&l in e&&(d=ce(e[l],d)),e={...e,[l]:d};H(n.hooks)&&(o=Re(o,n.hooks),e.hooks=o),H(n.headers)&&(r=Fe(r,n.headers),e.headers=r)}return e},Nt=(()=>{let t=!1,e=!1;const r=typeof globalThis.ReadableStream=="function",o=typeof globalThis.Request=="function";if(r&&o)try{e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type")}catch(n){if(n instanceof Error&&n.message==="unsupported BodyInit type")return!1;throw n}return t&&!e})(),It=typeof globalThis.AbortController=="function",Dt=typeof globalThis.ReadableStream=="function",Lt=typeof globalThis.FormData=="function",Oe=["get","post","put","patch","head","delete"],Mt={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},le=2147483647,Ne=Symbol("stop"),Ut={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},qt={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0},Jt=t=>Oe.includes(t)?t.toUpperCase():t,Ie={limit:2,methods:["get","put","head","delete","options","trace"],statusCodes:[408,413,429,500,502,503,504],afterStatusCodes:[413,429,503],maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:t=>.3*2**(t-1)*1e3},Pt=(t={})=>{if(typeof t=="number")return{...Ie,limit:t};if(t.methods&&!Array.isArray(t.methods))throw new Error("retry.methods must be an array");if(t.statusCodes&&!Array.isArray(t.statusCodes))throw new Error("retry.statusCodes must be an array");return{...Ie,...t}};async function Ht(t,e,r,o){return new Promise((n,l)=>{const d=setTimeout(()=>{r&&r.abort(),l(new Be(t))},o.timeout);o.fetch(t,e).then(n).catch(l).then(()=>{clearTimeout(d)})})}async function Qt(t,{signal:e}){return new Promise((r,o)=>{e&&(e.throwIfAborted(),e.addEventListener("abort",n,{once:!0}));function n(){clearTimeout(l),o(e.reason)}const l=setTimeout(()=>{e==null||e.removeEventListener("abort",n),r()},t)})}const jt=(t,e)=>{const r={};for(const o in e)!(o in qt)&&!(o in Ut)&&!(o in t)&&(r[o]=e[o]);return r};class ${constructor(e,r={}){_(this,"request");_(this,"abortController");_(this,"_retryCount",0);_(this,"_input");_(this,"_options");var o,n;if(this._input=e,this._options={...r,headers:Fe(this._input.headers,r.headers),hooks:Re({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},r.hooks),method:Jt(r.method??this._input.method),prefixUrl:String(r.prefixUrl||""),retry:Pt(r.retry),throwHttpErrors:r.throwHttpErrors!==!1,timeout:r.timeout??1e4,fetch:r.fetch??globalThis.fetch.bind(globalThis)},typeof this._input!="string"&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&typeof this._input=="string"){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(It){this.abortController=new globalThis.AbortController;const l=this._options.signal??this._input.signal;l==null||l.addEventListener("abort",()=>{this.abortController.abort(l.reason)}),this._options.signal=this.abortController.signal}if(Nt&&(this._options.duplex="half"),this._options.json!==void 0&&(this._options.body=((n=(o=this._options).stringifyJson)==null?void 0:n.call(o,this._options.json))??JSON.stringify(this._options.json),this._options.headers.set("content-type",this._options.headers.get("content-type")??"application/json")),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){const d="?"+(typeof this._options.searchParams=="string"?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString()),m=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,d);(Lt&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(m,{...this.request}),this._options)}}static create(e,r){const o=new $(e,r),n=async()=>{if(typeof o._options.timeout=="number"&&o._options.timeout>le)throw new RangeError(`The \`timeout\` option cannot be greater than ${le}`);await Promise.resolve();let m=await o._fetch();for(const u of o._options.hooks.afterResponse){const f=await u(o.request,o._options,o._decorateResponse(m.clone()));f instanceof globalThis.Response&&(m=f)}if(o._decorateResponse(m),!m.ok&&o._options.throwHttpErrors){let u=new xe(m,o.request,o._options);for(const f of o._options.hooks.beforeError)u=await f(u);throw u}if(o._options.onDownloadProgress){if(typeof o._options.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!Dt)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return o._stream(m.clone(),o._options.onDownloadProgress)}return m},d=o._options.retry.methods.includes(o.request.method.toLowerCase())?o._retry(n):n();for(const[m,u]of Object.entries(Mt))d[m]=async()=>{o.request.headers.set("accept",o.request.headers.get("accept")||u);const f=await d;if(m==="json"){if(f.status===204||(await f.clone().arrayBuffer()).byteLength===0)return"";if(r.parseJson)return r.parseJson(await f.text())}return f[m]()};return d}_calculateRetryDelay(e){if(this._retryCount++,this._retryCount>this._options.retry.limit||e instanceof Be)throw e;if(e instanceof xe){if(!this._options.retry.statusCodes.includes(e.response.status))throw e;const o=e.response.headers.get("Retry-After")??e.response.headers.get("RateLimit-Reset")??e.response.headers.get("X-RateLimit-Reset")??e.response.headers.get("X-Rate-Limit-Reset");if(o&&this._options.retry.afterStatusCodes.includes(e.response.status)){let n=Number(o)*1e3;Number.isNaN(n)?n=Date.parse(o)-Date.now():n>=Date.parse("2024-01-01")&&(n-=Date.now());const l=this._options.retry.maxRetryAfter??n;return n<l?n:l}if(e.response.status===413)throw e}const r=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,r)}_decorateResponse(e){return this._options.parseJson&&(e.json=async()=>this._options.parseJson(await e.text())),e}async _retry(e){try{return await e()}catch(r){const o=Math.min(this._calculateRetryDelay(r),le);if(this._retryCount<1)throw r;await Qt(o,{signal:this._options.signal});for(const n of this._options.hooks.beforeRetry)if(await n({request:this.request,options:this._options,error:r,retryCount:this._retryCount})===Ne)return;return this._retry(e)}}async _fetch(){for(const o of this._options.hooks.beforeRequest){const n=await o(this.request,this._options);if(n instanceof Request){this.request=n;break}if(n instanceof Response)return n}const e=jt(this.request,this._options),r=this.request;return this.request=r.clone(),this._options.timeout===!1?this._options.fetch(r,e):Ht(r,e,this.abortController,this._options)}_stream(e,r){const o=Number(e.headers.get("content-length"))||0;let n=0;return e.status===204?(r&&r({percent:1,totalBytes:o,transferredBytes:n},new Uint8Array),new globalThis.Response(null,{status:e.status,statusText:e.statusText,headers:e.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(l){const d=e.body.getReader();r&&r({percent:0,transferredBytes:0,totalBytes:o},new Uint8Array);async function m(){const{done:u,value:f}=await d.read();if(u){l.close();return}if(r){n+=f.byteLength;const y=o===0?0:n/o;r({percent:y,transferredBytes:n,totalBytes:o},f)}l.enqueue(f),await m()}await m()}}),{status:e.status,statusText:e.statusText,headers:e.headers})}}/*! MIT License © Sindre Sorhus */const ue=t=>{const e=(r,o)=>$.create(r,X(t,o));for(const r of Oe)e[r]=(o,n)=>$.create(o,X(t,n,{method:r}));return e.create=r=>ue(X(r)),e.extend=r=>(typeof r=="function"&&(r=r(t??{})),ue(X(t,r))),e.stop=Ne,e},ee=ue().create({prefixUrl:"https://api.github.com",timeout:6e4,retry:1,hooks:{beforeRequest:[async t=>{let e=await I.build();t.headers.set("Authorization",`Bearer ${e.githubToken}`),t.headers.set("Content-Type","application/json;charset=utf-8"),t.headers.set("X-GitHub-Api-Version","2022-11-28"),t.headers.set("Accept","application/vnd.github+json"),t.headers.set("cache","no-store")}]}});class Yt{async get(){let e=await I.build(),r=await ee.get(`gists/${e.gistID}`).json();if(r!=null&&r.files&&Object.keys(r.files).indexOf(e.gistFileName)!==-1){let n=r.files[e.gistFileName];return n.truncated?ee.get(n.raw_url,{prefixUrl:""}).text():n.content}return null}async getAllGist(){return ee.get("gists").json()}async update(e){let r=await I.build();return ee.patch(`gists/${r.gistID}`,{json:e}).json()}}const Q=new Yt,j="data:image/png;base64,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";class fe{constructor(){_(this,"browser","chrome");_(this,"version","1.0.0");_(this,"createDate",Date.now());_(this,"bookmarks",[])}}var Y=(t=>(t[t.FIREFOX=0]="FIREFOX",t[t.CHROME=1]="CHROME",t[t.EDGE=2]="EDGE",t))(Y||{}),N=(t=>(t[t.NONE=0]="NONE",t[t.SYNC=1]="SYNC",t[t.CHANGE=2]="CHANGE",t[t.CREATE=3]="CREATE",t[t.MOVE=4]="MOVE",t[t.REMOVE=5]="REMOVE",t))(N||{}),O=(t=>(t.MenuFolder="MenuFolder",t.ToolbarFolder="ToolbarFolder",t.UnfiledFolder="UnfiledFolder",t.MobileFolder="MobileFolder",t))(O||{});const Zt=E(()=>{a.runtime.onInstalled.addListener(s=>{v()});let t=N.NONE,e=Y.CHROME,r=null,o=0,n=!1;const l=3e3,d="✓",m="!",u="↻";a.runtime.onMessage.addListener((s,i,c)=>(s.name==="upload"&&(t=N.SYNC,f().then(()=>{t=N.NONE,a.action.setBadgeText({text:d}),a.action.setBadgeBackgroundColor({color:"#00AA00"}),T(),c(!0)})),s.name==="download"&&(t=N.SYNC,y().then(()=>{t=N.NONE,a.action.setBadgeText({text:d}),a.action.setBadgeBackgroundColor({color:"#00AA00"}),T(),c(!0)})),s.name==="removeAll"&&(t=N.REMOVE,p().then(()=>{t=N.NONE,a.action.setBadgeText({text:d}),a.action.setBadgeBackgroundColor({color:"#00AA00"}),T(),c(!0)})),s.name==="setting"&&a.runtime.openOptionsPage().then(()=>{c(!0)}),s.name==="updateAutoSync"&&v().then(()=>{c(!0)}),!0)),a.bookmarks.onCreated.addListener(async(s,i)=>{t===N.NONE&&(a.action.setBadgeText({text:m}),a.action.setBadgeBackgroundColor({color:"#FFA500"}),T(),await k())}),a.bookmarks.onChanged.addListener(async(s,i)=>{t===N.NONE&&(a.action.setBadgeText({text:m}),a.action.setBadgeBackgroundColor({color:"#FFA500"}),await k())}),a.bookmarks.onMoved.addListener(async(s,i)=>{t===N.NONE&&(a.action.setBadgeText({text:m}),a.action.setBadgeBackgroundColor({color:"#FFA500"}),await k())}),a.bookmarks.onRemoved.addListener(async(s,i)=>{t===N.NONE&&(a.action.setBadgeText({text:m}),a.action.setBadgeBackgroundColor({color:"#FFA500"}),T(),await k())});async function f(){try{let s=await I.build();if(s.githubToken=="")throw new Error("Gist Token Not Found");if(s.gistID=="")throw new Error("Gist ID Not Found");if(s.gistFileName=="")throw new Error("Gist File Not Found");let i=await g(),c=new fe;c.version=a.runtime.getManifest().version,c.createDate=Date.now(),c.bookmarks=F(i),c.browser=navigator.userAgent,await Q.update({files:{[s.gistFileName]:{content:JSON.stringify(c)}},description:s.gistFileName});const h=S(c.bookmarks);await a.storage.local.set({remoteCount:h}),a.action.setBadgeText({text:d}),a.action.setBadgeBackgroundColor({color:"#00AA00"})}catch(s){console.error(s),await a.notifications.create({type:"basic",iconUrl:j,title:a.i18n.getMessage("uploadBookmarks"),message:`${a.i18n.getMessage("error")}：${s.message}`})}}async function y(){try{let s=await Q.get(),i=await I.build();if(s){let c=JSON.parse(s);if(c.bookmarks==null||c.bookmarks.length==0){i.enableNotify&&await a.notifications.create({type:"basic",iconUrl:j,title:a.i18n.getMessage("downloadBookmarks"),message:`${a.i18n.getMessage("error")}：Gist File ${i.gistFileName} is NULL`});return}await p(),await w(c.bookmarks);const h=S(c.bookmarks);await a.storage.local.set({remoteCount:h}),a.action.setBadgeText({text:d}),a.action.setBadgeBackgroundColor({color:"#00AA00"}),setTimeout(()=>{a.action.setBadgeText({text:""})},2e3)}else await a.notifications.create({type:"basic",iconUrl:j,title:a.i18n.getMessage("downloadBookmarks"),message:`${a.i18n.getMessage("error")}：Gist File ${i.gistFileName} Not Found`})}catch(s){console.error(s),await a.notifications.create({type:"basic",iconUrl:j,title:a.i18n.getMessage("downloadBookmarks"),message:`${a.i18n.getMessage("error")}：${s.message}`})}}async function g(){let s=await a.bookmarks.getTree();return s&&s[0].id==="root________"?e=Y.FIREFOX:e=Y.CHROME,s}async function p(){var s;try{let i=await I.build();if(i.githubToken=="")throw new Error("Gist Token Not Found");if(i.gistID=="")throw new Error("Gist ID Not Found");if(i.gistFileName=="")throw new Error("Gist File Not Found");let c=await g(),h=[];if((s=c[0].children)==null||s.forEach(D=>{var B;(B=D.children)==null||B.forEach(q=>{h.push(q)})}),h.length>0)for(let D of h)D.id&&await a.bookmarks.removeTree(D.id);t===N.REMOVE&&(a.action.setBadgeText({text:d}),a.action.setBadgeBackgroundColor({color:"#00AA00"}),setTimeout(()=>{a.action.setBadgeText({text:""})},2e3))}catch(i){console.error(i),await a.notifications.create({type:"basic",iconUrl:j,title:a.i18n.getMessage("removeAllBookmarks"),message:`${a.i18n.getMessage("error")}：${i.message}`})}}async function w(s){var i,c,h,D,B,q,re,oe,L;if(s!=null)for(let he=0;he<s.length;he++){let C=s[he];if(C.title==O.MenuFolder||C.title==O.MobileFolder||C.title==O.ToolbarFolder||C.title==O.UnfiledFolder){if(e==Y.FIREFOX)switch(C.title){case O.MenuFolder:(i=C.children)==null||i.forEach(x=>x.parentId="menu________");break;case O.MobileFolder:(c=C.children)==null||c.forEach(x=>x.parentId="mobile______");break;case O.ToolbarFolder:(h=C.children)==null||h.forEach(x=>x.parentId="toolbar_____");break;case O.UnfiledFolder:(D=C.children)==null||D.forEach(x=>x.parentId="unfiled_____");break;default:(B=C.children)==null||B.forEach(x=>x.parentId="unfiled_____");break}else switch(C.title){case O.MobileFolder:(q=C.children)==null||q.forEach(x=>x.parentId="3");break;case O.ToolbarFolder:(re=C.children)==null||re.forEach(x=>x.parentId="1");break;case O.UnfiledFolder:case O.MenuFolder:(oe=C.children)==null||oe.forEach(x=>x.parentId="2");break;default:(L=C.children)==null||L.forEach(x=>x.parentId="2");break}await w(C.children);continue}let ne={id:"",title:""};try{ne=await a.bookmarks.create({parentId:C.parentId,title:C.title,url:C.url})}catch(x){console.error(ne,x)}ne.id&&C.children&&C.children.length>0&&(C.children.forEach(x=>x.parentId=ne.id),await w(C.children))}}function S(s){let i=0;return s&&s.forEach(c=>{c.url?i=i+1:i=i+S(c.children)}),i}async function T(){let s=await g();const i=S(s);await a.storage.local.set({localCount:i})}function F(s){if(s[0].children)for(let c of s[0].children)switch(c.id){case"1":case"toolbar_____":c.title=O.ToolbarFolder;break;case"menu________":c.title=O.MenuFolder;break;case"2":case"unfiled_____":c.title=O.UnfiledFolder;break;case"3":case"mobile______":c.title=O.MobileFolder;break}return b(s[0]).children}function b(s){var i;return s.dateAdded=void 0,s.dateGroupModified=void 0,s.id=void 0,s.index=void 0,s.parentId=void 0,s.type=void 0,s.unmodifiable=void 0,s.children&&s.children.length>0&&((i=s.children)==null||i.map(c=>b(c))),s}async function v(){r&&(clearTimeout(r),r=null);const s=await I.build();s.enableAutoSync&&s.githubToken&&s.gistID&&(a.action.setBadgeText({text:d}),a.action.setBadgeBackgroundColor({color:"#00AA00"}),await A())}async function k(){const s=await I.build();!s.enableAutoSync||!s.githubToken||!s.gistID||(r&&clearTimeout(r),r=setTimeout(async()=>{await A(),r=null},l))}async function A(){try{const s=await I.build();if(!s.enableAutoSync||!s.githubToken||!s.gistID)return;n=!0,a.action.setBadgeText({text:u}),a.action.setBadgeBackgroundColor({color:"#0000FF"}),t=N.SYNC;const i=await g(),c=S(i),h=F(i),D=await Q.get();if(D){const B=JSON.parse(D),q=S(B.bookmarks),re=JSON.stringify(h),oe=JSON.stringify(B.bookmarks);if(re===oe)console.log("Auto-sync: Already in sync"),o=B.createDate;else if(o>0&&B.createDate>o)console.log("Auto-sync: Downloading newer remote changes"),await p(),await w(B.bookmarks),await a.storage.local.set({remoteCount:q}),o=B.createDate;else{console.log("Auto-sync: Uploading local changes");const L=new fe;L.version=a.runtime.getManifest().version,L.createDate=Date.now(),L.bookmarks=h,L.browser=navigator.userAgent,await Q.update({files:{[s.gistFileName]:{content:JSON.stringify(L)}},description:s.gistFileName}),await a.storage.local.set({remoteCount:c}),o=L.createDate}}else{console.log("Auto-sync: Initial upload");const B=new fe;B.version=a.runtime.getManifest().version,B.createDate=Date.now(),B.bookmarks=h,B.browser=navigator.userAgent,await Q.update({files:{[s.gistFileName]:{content:JSON.stringify(B)}},description:s.gistFileName}),await a.storage.local.set({remoteCount:c}),o=B.createDate}a.action.setBadgeText({text:d}),a.action.setBadgeBackgroundColor({color:"#00AA00"})}catch(s){console.error("Auto-sync error:",s),a.action.setBadgeText({text:"✗"}),a.action.setBadgeBackgroundColor({color:"#FF0000"})}finally{n=!1,t=N.NONE,await T()}}v()});function er(){}function te(t,...e){}const Kt={debug:(...t)=>te(console.debug,...t),log:(...t)=>te(console.log,...t),warn:(...t)=>te(console.warn,...t),error:(...t)=>te(console.error,...t)};let de;try{de=Zt.main(),de instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(t){throw Kt.error("The background crashed on startup!"),t}return de}();
background;
